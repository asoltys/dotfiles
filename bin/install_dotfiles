#!/bin/bash
echo "$(whoami) ALL=NOPASSWD: ALL" | sudo tee -a /etc/sudoers

sudo apt-get install ruby ruby-dev vim git curl ack-grep exuberant-ctags golang -yyq

if [[ ! -z "$DISPLAY" ]]; then
  sudo apt-get install wmctrl vim-gtk -yyq
fi

wget https://nodejs.org/dist/v7.4.0/node-v7.4.0-linux-x64.tar.xz
sudo tar -C /usr/local --strip-components 1 -xJf node-v7.4.0-linux-x64.tar.xz

sudo gem install bundler
rsync -ar ~/dotfiles/ ~/

echo "Enter password"
read -s password
openssl aes-256-cbc -d -in ~/.github_credentials.enc -k $password -out ~/.github_credentials
openssl aes-256-cbc -d -in ~/.dropbox_credentials.enc -k $password -out ~/.dropbox_credentials
openssl aes-256-cbc -d -in ~/.netrc.enc -k $password -out ~/.netrc
openssl aes-256-cbc -d -in ~/.id_rsa.enc -k $password -out ~/.ssh/id_rsa
openssl aes-256-cbc -d -a -in ~/.gitconfig.enc -k $password -out ~/.gitconfig
openssl aes-256-cbc -d -in ~/.ssh/.config.enc -k $password -out ~/.ssh/config
echo "*" > ~/.git/info/exclude
ln -sf /usr/bin/git ~/bin/gits
chmod 600 ~/.ssh/id_rsa

mkdir -p ~/.local/share/fonts
cd ~/.local/share/fonts 
curl -fLo "DejaVu Sans Mono for Powerline Nerd Font Complete Mono.ttf" https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/DejaVuSansMono/Regular/complete/DejaVu%20Sans%20Mono%20for%20Powerline%20Nerd%20Font%20Complete%20Mono.ttf


if [ ! -d ~/.vim ]; then
  git clone https://github.com/asoltys/vim ~/.vim
  cd ~/.vim
  git submodule update --init
  ln s ~/.vim/.vimrc ~/.vimrc
fi

if [ ! -d ~/.hub ]; then
  wget https://github.com/github/hub/releases/download/v2.3.0-pre8/hub-linux-amd64-2.3.0-pre8.tgz
  tar xvfz hub-linux-amd64-2.3.0-pre8.tgz
  sudo hub-linux-amd64-2.3.0-pre8/install
  rm -rf hub-linux-amd64-2.3.0-pre8
fi

if [ ! -d ~/.bash_it ]; then
  git clone --depth=1 https://github.com/Bash-it/bash-it.git ~/.bash_it
  ~/.bash_it/install.sh --silent --no-modify-config
fi

if [ ! -d ~/.config/base16-shell ]; then
  git clone https://github.com/chriskempson/base16-shell.git ~/.config/base16-shell
  ~/.config/base16-shell/profile_helper.sh
fi

if [ ! -d ~/.fzf]; then
  git clone --depth=1 https://github.com/junegunn/fzf .fzf
  ~/.fzf/install
fi

source ~/.bashrc
bash-it disable alias general

rm -rf ~/dotfiles

echo "Installation complete"
exit
